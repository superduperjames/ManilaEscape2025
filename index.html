<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>The Haunted Spinner</title>
<style>
body {
  margin:0; height:100vh; overflow:hidden; font-family:'Courier New', monospace;
  background: url('https://res.cloudinary.com/eventmobi/image/upload/v1761237992/_James%20Assets/.test%20app%20assets/Abstract%20Backgrounds/Haunted%20Background/2151153754.jpg') no-repeat center center fixed;
  background-size: cover; position:relative; color:#fff;
  display:flex; flex-direction:column; justify-content:center; align-items:center;
}

/* Ghostly Mist */
.mist, .mist::before, .mist::after {
  content:""; position:absolute; top:0; left:0; width:200%; height:200%;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15), transparent 60%),
             radial-gradient(circle at 70% 70%, rgba(255,255,255,0.1), transparent 70%);
  mix-blend-mode: lighten; opacity:0.25; animation:fogMove 40s linear infinite; pointer-events:none;
}
.mist::before { animation:fogMove2 60s linear infinite; opacity:0.3; }
.mist::after { animation:fogMove3 90s linear infinite; opacity:0.2; }
@keyframes fogMove { from {transform:translateX(-10%) translateY(-10%) scale(1.2);} to {transform:translateX(10%) translateY(10%) scale(1.3);} }
@keyframes fogMove2 { from {transform:translateX(10%) translateY(0%) scale(1.1);} to {transform:translateX(-10%) translateY(5%) scale(1.25);} }
@keyframes fogMove3 { from {transform:translateX(-5%) translateY(5%) scale(1);} to {transform:translateX(5%) translateY(-5%) scale(1.2);} }

.container {
  position: relative;
  z-index: 2;
  text-align: center;
  background: black;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 0 20px #ff0000, 0 0 40px #ff4444;
  max-width: 480px;
  width: 90%;
  animation: flickerGlow 2.5s infinite alternate;
}

@keyframes flickerGlow {
  0% {
    box-shadow: 0 0 20px #ff0000, 0 0 40px #ff4444;
  }
  25% {
    box-shadow: 0 0 25px #ff5500, 0 0 50px #ff6666;
  }
  50% {
    box-shadow: 0 0 15px #ff3300, 0 0 35px #ff4444;
  }
  75% {
    box-shadow: 0 0 22px #ff4400, 0 0 45px #ff5555;
  }
  100% {
    box-shadow: 0 0 20px #ff0000, 0 0 40px #ff4444;
  }
}
h1 { margin-bottom:10px; font-size:2.2em; letter-spacing:2px; color:#ff6666; text-shadow:0 0 5px #ff0000,0 0 10px #ff4444; }
p.intro { font-size:1.1em; color:#ddd; margin-bottom:20px; animation:fadeIn 3s ease; }
input[type="email"], button { padding:10px; margin:10px; border:none; font-size:16px; border-radius:6px; }
input[type="email"] { width:260px; }
button { cursor:pointer; transition: all 0.3s ease; }
#resultBox {
  display:none; color:#fff; padding:20px; border-radius:10px; margin-top:20px;
  animation:fadeIn 1s ease forwards; background-color:black; text-align:center;
  font-size:1.2em; font-weight:bold;
}
#warningNote {
  display:none; color:#ff6666; margin-top:10px; font-size:0.9em;
  text-shadow:0 0 5px #ff6666,0 0 10px #ff9999; animation:floatPulse 2s ease-in-out infinite;
}

@keyframes fadeIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
@keyframes floatPulse { 0% {opacity:0.6; transform:translateY(0);} 25% {opacity:1; transform:translateY(-2px);} 50% {opacity:0.6; transform:translateY(-4px);} 75% {opacity:1; transform:translateY(-2px);} 100% {opacity:0.6; transform:translateY(0);} }

/* Admin Panel */
#adminLink { position:fixed; top:10px; right:20px; color:white; cursor:pointer; font-size:14px; opacity:0.7; z-index:3; }
#adminLink:hover { opacity:1; text-decoration:underline; }
#adminPanel { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
  background: rgba(255,255,255,0.95); color:#000; padding:20px; border-radius:10px; z-index:4; width:360px; max-width:90%;
}
#adminPanel textarea { width:100%; height:100px; margin-bottom:10px; box-sizing:border-box; }
#closeAdmin { position:absolute; top:5px; right:10px; cursor:pointer; font-weight:bold; }
#adminPanel input[type="password"] { width: calc(100% - 22px); padding:8px; margin-bottom:8px; box-sizing:border-box; }
#adminPanel button { background-color:black; color:white; border:none; border-radius:4px; padding:6px 12px; }
#adminPanel button:hover { background-color:#333; }

/* Spinning emojis */
.emoji { position:absolute; pointer-events:none; }
</style>
</head>
<body>

<div class="mist"></div>

<audio autoplay loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_16a6a84e64.mp3?filename=whispers-ambient-14032.mp3" type="audio/mpeg">
</audio>

<div id="adminLink">üëª Admin Login</div>

<div class="container">
  <h1>üé° The Haunted Spinner</h1>
  <p class="intro">Spin! Spin! Spin! Click here to reveal who the roulette has chosen for you...</p>
  <input type="email" id="emailInput" placeholder="Enter your email..." />
  <button id="spinBtn">Spin</button>

  <div id="resultBox"></div>
  <p id="warningNote">‚ö†Ô∏è Make sure to copy or screenshot your result! It will disappear if you leave or refresh the page.</p>
</div>

<div id="adminPanel">
  <span id="closeAdmin">‚úñ</span>
  <h3>Admin Panel</h3>
  <input type="password" id="adminPassword" placeholder="Enter password" />
  <button id="loginBtn">Login</button>

  <div id="adminContent" style="display:none; margin-top:10px;">
    <p><b>Emails (old entries greyed out):</b></p>
    <textarea id="emailList"></textarea>
    <p><b>Results (old entries greyed out):</b></p>
    <textarea id="resultList"></textarea>
    <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:5px;">
      <button id="generateBtn">Generate Assignments</button>
      <button id="resetSpinBtn">Reset Spin</button>
      <button id="exportBtn">Export Results</button>
      <button id="clearBtn">Clear Entries</button>
    </div>
  </div>
</div>

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
<script>
const spinBtn = document.getElementById('spinBtn');
const emailInput = document.getElementById('emailInput');
const resultBox = document.getElementById('resultBox');
const warningNote = document.getElementById('warningNote');

const adminLink = document.getElementById('adminLink');
const adminPanel = document.getElementById('adminPanel');
const closeAdmin = document.getElementById('closeAdmin');
const loginBtn = document.getElementById('loginBtn');
const adminContent = document.getElementById('adminContent');
const generateBtn = document.getElementById('generateBtn');
const resetSpinBtn = document.getElementById('resetSpinBtn');
const exportBtn = document.getElementById('exportBtn');
const clearBtn = document.getElementById('clearBtn');

const ADMIN_PASSWORD = 'escape2025';
let assignments = {};

window.addEventListener('load', () => {
  const stored = localStorage.getItem('hauntedSpinnerAssignments');
  assignments = stored ? JSON.parse(stored) : {};
  resultBox.style.display = 'none';
  warningNote.style.display = 'none';
});

function normalizeEmail(e){ return (e || '').trim().toLowerCase(); }

function spawnEmojis() {
  const emojis = ["üéÉ","üëª","üíÄ","üî™","ü©∏","üï∑Ô∏è","ü¶á","üêà‚Äç‚¨õ","ü™¶","üòà"];
  for(let i=0;i<12;i++){
    const span = document.createElement('span');
    span.className='emoji';
    span.textContent = emojis[Math.floor(Math.random()*emojis.length)];
    span.style.top = Math.random()*window.innerHeight + 'px';
    span.style.left = Math.random()*window.innerWidth + 'px';
    const size = 20 + Math.random()*40; 
    span.style.fontSize = size + 'px';
    const direction = Math.random() < 0.5 ? 1 : -1;
    const duration = 1 + Math.random()*1.5;
    span.animate([
      { transform: 'rotate(0deg) scale(1)', opacity:1 },
      { transform: `rotate(${direction*360}deg) scale(1.2)`, opacity:1, offset:0.5 },
      { transform: `rotate(${direction*720}deg) scale(0.8)`, opacity:0 }
    ], { duration: duration*1000, easing: 'ease-in-out' });
    document.body.appendChild(span);
    setTimeout(()=>span.remove(), duration*1000);
  }
}

spinBtn.addEventListener('click', ()=>{
  const emailRaw = emailInput.value.trim();
  if(!emailRaw){ alert('Please enter your email before spinning!'); return; }
  const emailKey = normalizeEmail(emailRaw);

  spawnEmojis();

  resultBox.style.display='none';
  warningNote.style.display='none';

  setTimeout(()=>{
    let result = assignments[emailKey] || "No assigned result for this email!";
    resultBox.textContent = `The roulette has chosen: ${result}`;
    resultBox.style.display='block';
    warningNote.style.display='block';

    emailInput.disabled=true;
    spinBtn.disabled=true;
    emailInput.style.opacity=0.5;
    spinBtn.style.opacity=0.5;
    spinBtn.style.cursor='not-allowed';
  },1500);
});

// Admin panel
adminLink.addEventListener('click',()=>{ adminPanel.style.display='block'; });
closeAdmin.addEventListener('click',()=>adminPanel.style.display='none');

loginBtn.addEventListener('click',()=>{
  const password=document.getElementById('adminPassword').value||'';
  if(password===ADMIN_PASSWORD){
    adminContent.style.display='block';
    alert('Admin login successful!');

    const stored = localStorage.getItem('hauntedSpinnerAssignments');
    assignments = stored ? JSON.parse(stored) : {};

    const emailListArea = document.getElementById('emailList');
    const resultListArea = document.getElementById('resultList');

    // Build old entries
    let emailContent = '';
    let resultContent = '';
    for(let email in assignments){
        emailContent += email + ',';
        resultContent += assignments[email] + '\n';
    }
    emailContent += '\n'; resultContent += '\n';
    emailListArea.value = emailContent;
    resultListArea.value = resultContent;

    // Grey out old entries
    emailListArea.style.color = '#888'; emailListArea.style.fontStyle='italic';
    resultListArea.style.color = '#888'; resultListArea.style.fontStyle='italic';

    // Make old lines uneditable
    emailListArea.addEventListener('keydown', e=>{ if(emailListArea.selectionStart < emailContent.length-1) e.preventDefault(); });
    resultListArea.addEventListener('keydown', e=>{ if(resultListArea.selectionStart < resultContent.length-1) e.preventDefault(); });

  } else alert('Incorrect password!');
});

// generate assignments
generateBtn.addEventListener('click',()=>{
  const emailRaw = document.getElementById('emailList').value;
  const resultsRaw = document.getElementById('resultList').value;
  const emailLines = emailRaw.split(/[\n,]+/).map(e=>normalizeEmail(e)).filter(e=>e);
  const resultLines = resultsRaw.split('\n').map(r=>r.trim()).filter(r=>r);

  emailLines.forEach((email,i)=>{ if(!(email in assignments) && resultLines[i]) assignments[email]=resultLines[i]; });
  localStorage.setItem('hauntedSpinnerAssignments',JSON.stringify(assignments));
  alert(`Assignments saved! Total: ${Object.keys(assignments).length} entries.`);
});

// reset spin
resetSpinBtn.addEventListener('click',()=>{
  resultBox.style.display='none';
  warningNote.style.display='none';
  emailInput.value='';
  emailInput.disabled=false;
  spinBtn.disabled=false;
  emailInput.style.opacity=1;
  spinBtn.style.opacity=1;
  spinBtn.style.cursor='pointer';
});

// Export Results
exportBtn.addEventListener('click',()=>{
  const data=[["Email","Result"]];
  for(let email in assignments){ data.push([email,assignments[email]]); }
  const ws=XLSX.utils.aoa_to_sheet(data);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,"Results");
  XLSX.writeFile(wb,"HauntedSpinnerResults.xlsx");
});

// Clear all entries
clearBtn.addEventListener('click', () => {
  if(confirm("Are you sure you want to clear all entries? This cannot be undone.")) {
    assignments = {};
    localStorage.removeItem('hauntedSpinnerAssignments');
    document.getElementById('emailList').value = '\n';
    document.getElementById('resultList').value = '\n';
    document.getElementById('emailList').style.color = '#000';
    document.getElementById('emailList').style.fontStyle = 'normal';
    document.getElementById('resultList').style.color = '#000';
    document.getElementById('resultList').style.fontStyle = 'normal';
    alert("All entries cleared. You can start a fresh new list!");
  }
});
</script>

</body>
</html>
