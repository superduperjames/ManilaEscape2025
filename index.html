<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ghoul Swap Roulette</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Creepster&display=swap');

    body {
      margin: 0;
      font-family: 'Creepster', cursive;
      color: #f1f1f1;
      background: url('https://res.cloudinary.com/eventmobi/image/upload/v1761682061/_James%20Assets/.test%20app%20assets/MML%20October%202025/62422-504238932_small-ezgif.com-video-to-gif-converter.gif') center/cover fixed no-repeat;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    .container {
      background: rgba(0, 0, 0, 0.7);
      border: 3px solid #7b0000;
      border-radius: 15px;
      padding: 30px;
      text-align: center;
      box-shadow: 0 0 30px #7b0000;
      width: 90%;
      max-width: 500px;
    }

    h1 {
      font-size: 2.5em;
      color: #ff3333;
      text-shadow: 2px 2px 10px black;
    }

    input {
      width: 80%;
      padding: 10px;
      border-radius: 5px;
      border: none;
      margin: 10px 0;
    }

    button {
      font-family: 'Creepster', cursive;
      background: #7b0000;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 20px;
      cursor: pointer;
      transition: 0.3s;
      margin: 5px;
    }

    button:hover {
      background: #ff3333;
      box-shadow: 0 0 10px #ff0000;
    }

    #result {
      margin-top: 20px;
      font-size: 1.4em;
    }

    #adminBtn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: transparent;
      border: 2px solid #ff0000;
      color: #ff0000;
      padding: 5px 10px;
      font-size: 1.2em;
      border-radius: 10px;
    }

    /* Admin modal styling */
    #adminModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.95);
      justify-content: center;
      align-items: center;
      z-index: 100;
    }

    #adminPanel {
      background: rgba(30, 0, 0, 0.95);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 30px #ff0000;
      width: 90%;
      max-width: 600px;
      text-align: center;
    }

    textarea {
      width: 90%;
      height: 100px;
      background: #000;
      color: #ff9999;
      border: 2px solid #ff3333;
      border-radius: 10px;
      margin-bottom: 15px;
      padding: 10px;
      font-family: monospace;
    }

    #closeModal {
      position: absolute;
      top: 30px;
      right: 40px;
      font-size: 2em;
      color: #ff0000;
      cursor: pointer;
    }

    #adminMsg {
      margin-top: 10px;
      font-size: 1em;
      color: #f1f1f1;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ghoul Swap Roulette</h1>
    <input type="email" id="emailInput" placeholder="Enter your email..." />
    <button id="spinBtn">Spin the Wheel of Fate ‚ò†Ô∏è</button>
    <div id="result"></div>
  </div>

  <button id="adminBtn">‚ò†Ô∏è</button>

  <!-- Admin Modal -->
  <div id="adminModal">
    <div id="adminPanel">
      <span id="closeModal">‚úñ</span>
      <h2>Admin Panel</h2>
      <textarea id="emailsText" placeholder="Emails (one per line)"></textarea>
      <textarea id="codesText" placeholder="Codenames and Gender (one per line, comma or tab separated)"></textarea>
      <br>
      <button id="saveListsBtn">Save Lists</button>
      <button id="generate">Generate Assignments</button>
      <button id="reset">Reset List</button>
      <button id="seeResults">Open List</button>
      <div id="adminMsg"></div>
    </div>
  </div>

  <script>
    const APPS_SCRIPT_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwa0LPjNrc-bJvwgsYPRNVRayGAJDyXMwveh_cuQN7mvqw-fBYoba8yU-V6NCOleAnx/exec"; // Put your web app URL here
    const ADMIN_PASSWORD = "escape2025";

    const adminBtn = document.getElementById("adminBtn");
    const adminModal = document.getElementById("adminModal");
    const closeModal = document.getElementById("closeModal");
    const adminMsg = document.getElementById("adminMsg");
    const spinBtn = document.getElementById("spinBtn");
    const resultDiv = document.getElementById("result");
    const emailInput = document.getElementById("emailInput");

    // Show admin panel if password correct
    adminBtn.addEventListener("click", () => {
      const password = prompt("Enter the secret password:");
      if (password === ADMIN_PASSWORD) {
        adminModal.style.display = "flex";
        adminMsg.textContent = "Welcome, Admin. Your dark powers are active.";
      } else {
        alert("Incorrect password. The spirits reject you.");
      }
    });

    closeModal.addEventListener("click", () => adminModal.style.display = "none");
    window.addEventListener("click", (e) => {
      if (e.target === adminModal) adminModal.style.display = "none";
    });

    async function postAction(body) {
      const res = await fetch(APPS_SCRIPT_WEB_APP_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });
      return res.json();
    }

    async function getAction(params) {
      const url = new URL(APPS_SCRIPT_WEB_APP_URL);
      Object.entries(params).forEach(([k, v]) => url.searchParams.set(k, v));
      const res = await fetch(url);
      return res.json();
    }

    // ===== Admin actions =====
    document.getElementById("saveListsBtn").addEventListener("click", async () => {
      const emails = document.getElementById("emailsText").value.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
      const codes = document.getElementById("codesText").value.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
      adminMsg.textContent = "Saving lists...";
      const r = await postAction({ action: "saveLists", payload: { emails, codes } });
      adminMsg.textContent = r.message || "Lists saved.";
    });

    document.getElementById("generate").addEventListener("click", async () => {
      adminMsg.textContent = "Generating assignments...";
      const r = await postAction({ action: "generateAssignments" });
      adminMsg.textContent = r.message || "Assignments generated.";
    });

    document.getElementById("reset").addEventListener("click", async () => {
      adminMsg.textContent = "Resetting list...";
      const r = await postAction({ action: "resetAssignments" });
      adminMsg.textContent = r.message || "List reset.";
    });

    document.getElementById("seeResults").addEventListener("click", async () => {
      const r = await getAction({ action: "getSheetUrl" });
      if (r.sheetUrl) window.open(r.sheetUrl, "_blank");
      else adminMsg.textContent = "Could not open list.";
    });

    // ===== User Roulette =====
    spinBtn.addEventListener("click", async () => {
      const email = emailInput.value.trim();
      if (!email) {
        resultDiv.textContent = "Enter your email first, mortal...";
        return;
      }
      resultDiv.textContent = "Summoning your fate...";
      const r = await getAction({ action: "getAssignment", email });
      if (r.ok) {
        resultDiv.textContent = `üéÉ Your code name is: ${r.code} (${r.gender})`;
      } else {
        resultDiv.textContent = `üëª ${r.message}`;
      }
    });
  </script>
</body>
</html>
