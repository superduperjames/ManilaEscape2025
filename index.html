<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Secret Assignment Admin</title>
  <style>
    body {
      font-family: 'Syne Mono', monospace;
      background-color: #000;
      color: #00ffcc;
      text-align: center;
      padding: 30px;
    }
    input, textarea, button {
      background: #111;
      color: #00ffcc;
      border: 1px solid #00ffcc;
      border-radius: 6px;
      padding: 8px;
      margin: 8px;
      width: 80%;
      max-width: 400px;
      font-family: 'Syne Mono', monospace;
    }
    button {
      cursor: pointer;
      transition: all 0.3s;
    }
    button:hover {
      background: #00ffcc;
      color: #000;
    }
    .admin-panel {
      margin-top: 30px;
      display: none;
    }
    .close-btn {
      margin-top: 20px;
      background: #ff4444;
      border-color: #ff4444;
    }
    .close-btn:hover {
      background: #ff0000;
      color: white;
    }
  </style>
</head>
<body>
  <h1>üéÅ Secret Assignment Portal</h1>

  <!-- Login Form -->
  <div id="loginPanel">
    <p>Enter your email to see your assigned code name:</p>
    <input type="email" id="emailInput" placeholder="Enter your email" />
    <button onclick="checkAssignment()">Reveal Assignment</button>
    <p id="assignmentResult"></p>
  </div>

  <!-- Admin Access -->
  <div class="admin-login">
    <p>Admin access:</p>
    <input type="password" id="adminPass" placeholder="Enter admin password" />
    <button onclick="openAdmin()">Login</button>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel" class="admin-panel">
    <h2>Admin Panel</h2>
    <textarea id="emails" placeholder="Enter email list, one per line"></textarea><br>
    <textarea id="codenames" placeholder="Enter codename,gender pairs (e.g. Shadow,Male) one per line"></textarea><br>
    <button onclick="generateAssignments()">Generate Assignments</button>
    <button onclick="clearAssignments()">Clear Assignments</button><br>
    <button class="close-btn" onclick="closeAdmin()">Close</button>
    <p id="adminStatus"></p>
  </div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyFhhcFjrmDWRQ6hOItTi_-u2Wa1PXa38EAZCF2DSh0TfW_yydYVsoEb5IYpIrfdGMM/exec";

// --- PLAYER FUNCTIONALITY ---

async function checkAssignment() {
  const email = document.getElementById("emailInput").value.trim();
  const resultDiv = document.getElementById("reveal-result");

  if (!email) {
    showModal("Error", "Please enter your email first, wanderer...");
    return;
  }

  resultDiv.innerHTML = "üëª Consulting the spirits...";

  try {
    const response = await fetch(`${SCRIPT_URL}?email=${encodeURIComponent(email)}`);
    const data = await response.json();

    if (data.error) {
      resultDiv.innerHTML = "üíÄ " + data.error;
    } else {
      resultDiv.innerHTML = `
        üïØÔ∏è <b>Code Name:</b> ${data.codeName}<br>
        üé≠ <b>Gender:</b> ${data.gender}
      `;
    }
  } catch (error) {
    resultDiv.innerHTML = "‚ò†Ô∏è Something went wrong. Try again later.";
  }
}

// --- ADMIN FUNCTIONALITY ---

async function generateAssignments() {
  const emails = document.getElementById("emailsInput").value.trim().split("\n").filter(x => x);
  const codenames = document.getElementById("codenamesInput").value.trim().split("\n").filter(x => x);

  if (emails.length === 0 || codenames.length === 0) {
    showModal("Error", "Please fill in both the emails and codenames before generating.");
    return;
  }

  showModal("Working...", "üîÆ Randomizing the assignments... please wait...");

  try {
    const response = await fetch(SCRIPT_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action: "generateAssignments",
        emails: emails,
        codenames: codenames
      }),
    });

    const data = await response.json();

    if (data.status === "success") {
      showModal("Success", "üé≤ Assignments have been randomized successfully!");
    } else {
      showModal("Error", "‚ö†Ô∏è Something went wrong: " + (data.message || "Unknown error"));
    }
  } catch (err) {
    showModal("Error", "üíÄ " + err.message);
  }
}

function clearAssignments() {
  fetch(SCRIPT_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ action: "clearAssignments" }),
  })
  .then(r => r.json())
  .then(data => {
    if (data.status === "cleared") {
      showModal("Cleared", "üßπ All assignments have been wiped clean!");
    } else {
      showModal("Error", "Failed to clear assignments.");
    }
  })
  .catch(() => showModal("Error", "Network error while clearing assignments."));
}

function openAssignments() {
  window.open("https://docs.google.com/spreadsheets/d/19BT53bGqcqZHbwop8qhEFNSDQx/edit?usp=sharing", "_blank");
}

// --- ADMIN PANEL CONTROL ---

function openAdminLogin() {
  document.getElementById("player-section").style.display = "none";
  document.getElementById("admin-section").style.display = "block";
}

function closeAdminPanel() {
  document.getElementById("admin-section").style.display = "none";
  document.getElementById("player-section").style.display = "block";
}

// --- MODAL CONTROL ---

function showModal(title, message) {
  document.getElementById("modalTitle").innerText = title;
  document.getElementById("modalMessage").innerText = message;
  document.getElementById("modal").classList.add("show");
}

function closeModal() {
  const modal = document.getElementById("modal");
  modal.classList.remove("show");
}
</script>

</body>
</html>
