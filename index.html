<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Spooky Roulette</title>
<style>
  body {
    margin: 0;
    height: 100vh;
    overflow: hidden;
    background: #000;
    color: #fff;
    font-family: 'Courier New', monospace;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    position: relative;
  }

  /* Ghostly Mist */
  .mist, .mist::before, .mist::after {
    content: "";
    position: absolute;
    top: 0; left: 0;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.15), transparent 60%),
                radial-gradient(circle at 70% 70%, rgba(255,255,255,0.1), transparent 70%);
    mix-blend-mode: lighten;
    opacity: 0.25;
    animation: fogMove 40s linear infinite;
    pointer-events: none;
  }
  .mist::before { animation: fogMove2 60s linear infinite; opacity: 0.3; }
  .mist::after { animation: fogMove3 90s linear infinite; opacity: 0.2; }

  @keyframes fogMove { from {transform:translateX(-10%) translateY(-10%) scale(1.2);} to {transform:translateX(10%) translateY(10%) scale(1.3);} }
  @keyframes fogMove2 { from {transform:translateX(10%) translateY(0%) scale(1.1);} to {transform:translateX(-10%) translateY(5%) scale(1.25);} }
  @keyframes fogMove3 { from {transform:translateX(-5%) translateY(5%) scale(1);} to {transform:translateX(5%) translateY(-5%) scale(1.2);} }

  .container { position: relative; z-index: 2; text-align: center; }
  h1 { margin-bottom: 10px; font-size: 2em; letter-spacing: 2px; }
  p.intro { font-size: 1.1em; color: #ddd; margin-bottom: 20px; animation: fadeIn 3s ease; }
  input[type="email"], button { padding: 10px; margin: 10px; border: none; font-size: 16px; border-radius: 6px; }
  input[type="email"] { width: 260px; }
  button { cursor: pointer; background: #fff; color: #000; transition: all 0.3s ease; }
  button:hover { background: #ccc; }
  #resultBox { display: none; background: #fff; color: #000; padding: 20px; border-radius: 10px; margin-top: 20px; animation: fadeIn 1s ease forwards; }

  #warningNote {
    display: none;
    color: #ff6666;
    margin-top: 10px;
    font-size: 0.9em;
    text-shadow: 0 0 5px #ff6666, 0 0 10px #ff9999;
    animation: floatPulse 2s ease-in-out infinite;
  }

  @keyframes fadeIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
  @keyframes floatPulse { 0% {opacity:0.6; transform:translateY(0);} 25% {opacity:1; transform:translateY(-2px);} 50% {opacity:0.6; transform:translateY(-4px);} 75% {opacity:1; transform:translateY(-2px);} 100% {opacity:0.6; transform:translateY(0);} }

  #adminLink { position: fixed; top: 10px; right: 20px; color: white; cursor: pointer; font-size: 14px; opacity: 0.7; z-index: 3; }
  #adminLink:hover { opacity: 1; text-decoration: underline; }

  #adminPanel { display: none; position: fixed; top:50%; left:50%; transform:translate(-50%,-50%); background: rgba(255,255,255,0.95); color:#000; padding:20px; border-radius:10px; z-index:4; width:320px; max-width:90%; }
  #adminPanel textarea { width: 100%; height: 80px; margin-bottom: 10px; box-sizing: border-box; }
  #closeAdmin { position:absolute; top:5px; right:10px; cursor:pointer; font-weight:bold; }
  #adminPanel input[type="password"] { width: calc(100% - 22px); padding:8px; margin-bottom:8px; box-sizing:border-box; }

  /* small responsive tweak */
  @media (max-width:420px){
    input[type="email"]{ width: 200px; }
    #adminPanel { width: 92%; }
  }
</style>
</head>
<body>

<div class="mist"></div>

<!-- Soft eerie background sound -->
<audio autoplay loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_16a6a84e64.mp3?filename=whispers-ambient-14032.mp3" type="audio/mpeg">
</audio>

<div id="adminLink">üëª Admin Login</div>

<div class="container">
  <h1>üé° Spooky Roulette</h1>
  <p class="intro">Enter if you dare‚Ä¶ spin to reveal who you end up with.</p>
  <input type="email" id="emailInput" placeholder="Enter your email..." />
  <button id="spinBtn">Spin</button>

  <div id="resultBox"></div>
  <p id="warningNote">‚ö†Ô∏è Make sure to copy or screenshot your result! It will disappear if you leave or refresh the page.</p>
</div>

<!-- Admin panel -->
<div id="adminPanel">
  <span id="closeAdmin">‚úñ</span>
  <h3>Admin Panel</h3>
  <input type="password" id="adminPassword" placeholder="Enter password" />
  <button id="loginBtn">Login</button>

  <div id="adminContent" style="display:none; margin-top:10px;">
    <p><b>Emails (comma-separated):</b></p>
    <textarea id="emailList" placeholder="alice@example.com, bob@example.com, charlie@example.com"></textarea>

    <p><b>Results (one per line, matching emails):</b></p>
    <textarea id="resultList" placeholder="üßõ Vampire\nüï∑Ô∏è Spider\nüëª Ghost"></textarea>

    <div style="display:flex; gap:8px; flex-wrap:wrap;">
      <button id="generateBtn">Generate Assignments</button>
      <button id="resetSpinBtn">Reset Spin</button>
    </div>
  </div>
</div>

<script>
  const spinBtn = document.getElementById('spinBtn');
  const emailInput = document.getElementById('emailInput');
  const resultBox = document.getElementById('resultBox');
  const warningNote = document.getElementById('warningNote');

  const adminLink = document.getElementById('adminLink');
  const adminPanel = document.getElementById('adminPanel');
  const closeAdmin = document.getElementById('closeAdmin');
  const loginBtn = document.getElementById('loginBtn');
  const adminContent = document.getElementById('adminContent');
  const generateBtn = document.getElementById('generateBtn');
  const resetSpinBtn = document.getElementById('resetSpinBtn');

  // UPDATED admin password
  const ADMIN_PASSWORD = 'escape2025';
  let assignments = {}; // { emailLower: result }

  // Utility: normalize email keys (lowercase)
  function normalizeEmail(e){ return (e || '').trim().toLowerCase(); }

  // Load previous spin if exists
  window.addEventListener('load', () => {
    const storedResult = localStorage.getItem('spookyResult');
    const storedEmail = localStorage.getItem('spookyEmail');
    if (storedResult && storedEmail) {
      resultBox.textContent = `You picked: ${storedResult}`;
      resultBox.style.display = 'block';
      warningNote.style.display = 'block';
      emailInput.value = storedEmail;
      emailInput.disabled = true;
      spinBtn.disabled = true;
      emailInput.style.opacity = 0.5;
      spinBtn.style.opacity = 0.5;
      spinBtn.style.cursor = 'not-allowed';
    }
  });

  // Spin logic (uses assignments if present)
  spinBtn.addEventListener('click', () => {
    const emailRaw = emailInput.value.trim();
    if (!emailRaw) {
      alert('Please enter your email before spinning!');
      return;
    }
    const emailKey = normalizeEmail(emailRaw);

    let result = assignments[emailKey];
    if (!result) {
      // fallback message for unassigned emails
      result = "No assigned result for this email!";
    }

    resultBox.textContent = `You picked: ${result}`;
    resultBox.style.display = 'block';
    warningNote.style.display = 'block';

    // disable input/button after spin
    emailInput.disabled = true;
    spinBtn.disabled = true;
    emailInput.style.opacity = 0.5;
    spinBtn.style.opacity = 0.5;
    spinBtn.style.cursor = 'not-allowed';

    // persist
    localStorage.setItem('spookyResult', result);
    localStorage.setItem('spookyEmail', emailRaw);
  });

  // Admin UI toggles
  adminLink.addEventListener('click', () => adminPanel.style.display = 'block');
  closeAdmin.addEventListener('click', () => adminPanel.style.display = 'none');

  // Admin login
  loginBtn.addEventListener('click', () => {
    const password = document.getElementById('adminPassword').value || '';
    if (password === ADMIN_PASSWORD) {
      adminContent.style.display = 'block';
      alert('Admin login successful!');
    } else {
      alert('Incorrect password!');
    }
  });

  // Generate assignments from admin input
  generateBtn.addEventListener('click', () => {
    const emailsRaw = document.getElementById('emailList').value;
    const resultsRaw = document.getElementById('resultList').value;

    const emails = emailsRaw.split(',').map(e => normalizeEmail(e)).filter(e => e);
    const results = resultsRaw.split('\n').map(r => r.trim()).filter(r => r);

    assignments = {};
    emails.forEach((email, i) => {
      if (results[i]) assignments[email] = results[i];
    });

    // If fewer results than emails -> leftover emails get "No assigned result..."
    alert('Assignments generated successfully!\n\n' +
          `${Object.keys(assignments).length} assignments created.`);
  });

  // Reset spin for testing (admin)
  resetSpinBtn.addEventListener('click', () => {
    localStorage.removeItem('spookyResult');
    localStorage.removeItem('spookyEmail');
    resultBox.style.display = 'none';
    warningNote.style.display = 'none';
    emailInput.value = '';
    emailInput.disabled = false;
    spinBtn.disabled = false;
    emailInput.style.opacity = 1;
    spinBtn.style.opacity = 1;
    spinBtn.style.cursor = 'pointer';
    alert('Spin has been reset. Users can spin again.');
  });

  // Optional: close admin panel when clicking outside it
  window.addEventListener('click', (e) => {
    if (e.target === adminPanel) adminPanel.style.display = 'none';
  });
</script>

</body>
</html>
