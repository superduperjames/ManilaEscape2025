<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Secret Assignment Admin</title>
  <style>
    body {
      font-family: 'Syne Mono', monospace;
      background-color: #000;
      color: #00ffcc;
      text-align: center;
      padding: 30px;
    }
    input, textarea, button {
      background: #111;
      color: #00ffcc;
      border: 1px solid #00ffcc;
      border-radius: 6px;
      padding: 8px;
      margin: 8px;
      width: 80%;
      max-width: 400px;
      font-family: 'Syne Mono', monospace;
    }
    button {
      cursor: pointer;
      transition: all 0.3s;
    }
    button:hover {
      background: #00ffcc;
      color: #000;
    }
    .admin-panel {
      margin-top: 30px;
      display: none;
    }
    .close-btn {
      margin-top: 20px;
      background: #ff4444;
      border-color: #ff4444;
    }
    .close-btn:hover {
      background: #ff0000;
      color: white;
    }
  </style>
</head>
<body>
  <h1>üéÅ Secret Assignment Portal</h1>

  <!-- Login Form -->
  <div id="loginPanel">
    <p>Enter your email to see your assigned code name:</p>
    <input type="email" id="emailInput" placeholder="Enter your email" />
    <button onclick="checkAssignment()">Reveal Assignment</button>
    <p id="assignmentResult"></p>
  </div>

  <!-- Admin Access -->
  <div class="admin-login">
    <p>Admin access:</p>
    <input type="password" id="adminPass" placeholder="Enter admin password" />
    <button onclick="openAdmin()">Login</button>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel" class="admin-panel">
    <h2>Admin Panel</h2>
    <textarea id="emails" placeholder="Enter email list, one per line"></textarea><br>
    <textarea id="codenames" placeholder="Enter codename,gender pairs (e.g. Shadow,Male) one per line"></textarea><br>
    <button onclick="generateAssignments()">Generate Assignments</button>
    <button onclick="clearAssignments()">Clear Assignments</button><br>
    <button class="close-btn" onclick="closeAdmin()">Close</button>
    <p id="adminStatus"></p>
  </div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzKeOYn3S1zXpcTlUHxhkz39AgZ2zDdtSEh60WdHF1MWpB3nPVi2eThEN3iN1Ag-IGI/exec"; // üîó Replace this with your actual Web App URL

    // Reveal assignment
    async function checkAssignment() {
      const email = document.getElementById('emailInput').value.trim();
      const resultEl = document.getElementById('assignmentResult');
      resultEl.textContent = "Fetching...";

      try {
        const res = await fetch(`${SCRIPT_URL}?email=${encodeURIComponent(email)}`);
        const data = await res.json();

        if (data.error) {
          resultEl.textContent = "‚ùå " + data.error;
        } else {
          resultEl.innerHTML = `
            üïµÔ∏è‚Äç‚ôÇÔ∏è Your Code Name: <strong>${data.assignedCodeName}</strong><br>
            ‚öß Gender: <strong>${data.assignedGender}</strong>
          `;
        }
      } catch (err) {
        resultEl.textContent = "Error fetching assignment.";
      }
    }

    // Admin access
    function openAdmin() {
      const pass = document.getElementById('adminPass').value;
      if (pass === "eventmobi2025") {
        document.getElementById('adminPanel').style.display = "block";
        document.getElementById('loginPanel').style.display = "none";
        document.querySelector('.admin-login').style.display = "none";
      } else {
        alert("Incorrect password!");
      }
    }

    function closeAdmin() {
      document.getElementById('adminPanel').style.display = "none";
      document.getElementById('loginPanel').style.display = "block";
      document.querySelector('.admin-login').style.display = "block";
    }

    // Generate assignments
    async function generateAssignments() {
      const emails = document.getElementById('emails').value.trim().split('\n').filter(e => e);
      const codenames = document.getElementById('codenames').value.trim().split('\n').filter(e => e);
      const adminStatus = document.getElementById('adminStatus');

      adminStatus.textContent = "Generating assignments...";

      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            action: "generateAssignments",
            data: { emails, codenames }
          })
        });
        const data = await res.json();
        if (data.status === "success") {
          adminStatus.textContent = "‚úÖ Assignments generated successfully!";
        } else {
          adminStatus.textContent = "‚ùå Failed: " + (data.error || "Unknown error");
        }
      } catch (err) {
        adminStatus.textContent = "‚ö†Ô∏è Error generating assignments.";
      }
    }

    // Clear assignments
    async function clearAssignments() {
      const adminStatus = document.getElementById('adminStatus');
      if (!confirm("Are you sure you want to clear all assignments?")) return;

      adminStatus.textContent = "Clearing...";
      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action: "clearAssignments" })
        });
        const data = await res.json();
        if (data.status === "cleared") {
          adminStatus.textContent = "üßπ All assignments cleared.";
        } else {
          adminStatus.textContent = "‚ùå Failed to clear assignments.";
        }
      } catch (err) {
        adminStatus.textContent = "‚ö†Ô∏è Error clearing assignments.";
      }
    }
  </script>
</body>
</html>
